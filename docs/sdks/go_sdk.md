# PromptCrafter Go SDK

[Download Go SDK](link)  
[Technical addendum](link)  

## Overview

The PromptCrafter Go SDK provides an idiomatic Go interface to the PromptCrafter API, enabling developers to easily manage and evaluate generative AI prompts, log outputs, and organize resources programmatically.  

**Key features:**
- Full CRUD operations for prompts and logs
- User authentication (signup & login) with JWT bearer tokens
- Full-text prompt search
- Extensible HTTP client with context & timeout support
- Typed data models matching the API

PromptCrafter is ideal for developers, prompt engineers, and teams who want to automate prompt library management or integrate prompt experimentation into their Go applications.

---

## Installation

Requirements:
- Go 1.18 or newer

To install the SDK:
```sh
go get github.com/yourorg/promptcrafter
```

Then, import the package in your Go code:
```go
import "github.com/yourorg/promptcrafter"
```

No additional dependencies are required. Ensure you have your API credentials.

---

## Authentication

All PromptCrafter API requests require a bearer token, provided in the `Authorization: Bearer {token}` header.

**Ways to obtain a token:**
1. **Sign up:** Create a new user account and receive a JWT token.
2. **Log in:** Authenticate with email and password to receive a JWT token.

### Example: Creating a Client

```go
client := promptcrafter.NewClient("your_token_here")
```

Or customize the client:
```go
httpClient := &http.Client{Timeout: 10 * time.Second}
client := promptcrafter.NewClient("your_token_here", promptcrafter.WithHTTPClient(httpClient))
```

### Example: Signing Up and Logging In

```go
ctx := context.Background()
signupResp, err := client.Signup(ctx, &promptcrafter.AuthSignupRequest{
    Name:     "Alice Example",
    Email:    "alice@example.com",
    Password: "securepassword",
})
if err != nil {
    log.Fatal(err)
}
token := signupResp.Token

// Or, log in with existing credentials:
loginResp, err := client.Login(ctx, &promptcrafter.AuthLoginRequest{
    Email:    "alice@example.com",
    Password: "securepassword",
})
if err != nil {
    log.Fatal(err)
}
client = promptcrafter.NewClient(loginResp.Token)
```

---

## Usage Examples

### Create a Prompt

```go
prompt, err := client.CreatePrompt(ctx, &promptcrafter.PromptCreateRequest{
    Title:   "Newsletter subject line",
    Content: "Write an engaging subject line for a product launch newsletter.",
    Model:   "GPT-4o",
    Tags:    []string{"email", "marketing"},
})
if err != nil {
    log.Fatal(err)
}
fmt.Printf("Created prompt: %#v\n", prompt)
```

### List Prompts

```go
prompts, err := client.ListPrompts(ctx)
if err != nil {
    log.Fatal(err)
}
for _, p := range prompts {
    fmt.Println(p.Title)
}
```

### Update a Prompt

```go
title := "Updated Title"
tags := []string{"updated", "sample"}
prompt, err := client.UpdatePrompt(ctx, "prompt_id", &promptcrafter.PromptUpdateRequest{
    Title: &title,
    Tags:  &tags,
})
if err != nil {
    log.Fatal(err)
}
fmt.Printf("Updated prompt: %#v\n", prompt)
```

### Delete a Prompt

```go
err := client.DeletePrompt(ctx, "prompt_id")
if err != nil {
    log.Fatal(err)
}
fmt.Println("Prompt deleted")
```

### Search Prompts

```go
results, err := client.SearchPrompts(ctx, "email subject")
if err != nil {
    log.Fatal(err)
}
for _, prompt := range results {
    fmt.Println(prompt.Title)
}
```

### Log an Output

```go
score := 9
logEntry, err := client.CreateLog(ctx, &promptcrafter.LogCreateRequest{
    PromptID:  "prompt_id",
    Output:    "Output generated by the model.",
    Notes:     "Sample output.",
    ModelUsed: "GPT-4o",
    Score:     &score,
})
if err != nil {
    log.Fatal(err)
}
fmt.Printf("Logged output: %#v\n", logEntry)
```

### List Logs by Prompt

```go
logs, err := client.ListLogsByPrompt(ctx, "prompt_id")
if err != nil {
    log.Fatal(err)
}
for _, logEntry := range logs {
    fmt.Printf("Log: %+v\n", logEntry)
}
```

---

## SDK Reference

### type Client

The main API client. All operations require an initialized `Client` instance.

```go
type Client struct {
    HTTPClient  *http.Client // Underlying HTTP client (default with timeouts)
    BaseURL     string       // Root API URL (default: https://promptcrafter-production.up.railway.app)
    BearerToken string       // JWT Bearer token for authentication
}
```

#### func NewClient

```go
func NewClient(token string, opts ...ClientOption) *Client
```
- `token` *(string, required)*: JWT token for API authentication.
- `opts` *(optional)*: Use `WithHTTPClient`, `WithBaseURL`, or `WithBearerToken` to customize the client.
- Returns: initialized `*Client`.

#### type ClientOption

A function signature for optional client configuration:
```go
type ClientOption func(*Client)
```

#### func WithHTTPClient

Set a custom HTTP client (e.g., to adjust timeouts).

```go
func WithHTTPClient(httpClient *http.Client) ClientOption
```

#### func WithBaseURL

Change the API root URL (useful for staging/testing).

```go
func WithBaseURL(baseURL string) ClientOption
```

#### func WithBearerToken

Set or override the bearer token.

```go
func WithBearerToken(token string) ClientOption
```

---

### Authentication Methods

#### func (c *Client) Signup

```go
func (c *Client) Signup(ctx context.Context, req *AuthSignupRequest) (*AuthResponse, error)
```

- `ctx` *(context.Context, required)*: Request context, controls deadlines/cancellation.
- `req` *(required)*: Pointer to `AuthSignupRequest`.
- Returns: `*AuthResponse`, `error`

Creates a new user account; returns a JWT token upon success.

#### func (c *Client) Login

```go
func (c *Client) Login(ctx context.Context, req *AuthLoginRequest) (*AuthResponse, error)
```

- `ctx` *(context.Context, required)*
- `req` *(required)*: Pointer to `AuthLoginRequest`.
- Returns: `*AuthResponse`, `error`

Authenticates user and returns JWT token.

---

### Prompt Methods

#### func (c *Client) ListPrompts

```go
func (c *Client) ListPrompts(ctx context.Context) ([]Prompt, error)
```
- Lists all prompts for the authenticated user.

#### func (c *Client) GetPrompt

```go
func (c *Client) GetPrompt(ctx context.Context, id string) (*Prompt, error)
```
- `id` *(string, required)*: Prompt ID.

Retrieves a prompt by ID (must be owned by the user).

#### func (c *Client) CreatePrompt

```go
func (c *Client) CreatePrompt(ctx context.Context, req *PromptCreateRequest) (*Prompt, error)
```
- `req` *(PromptCreateRequest, required)*: Prompt creation data.

Creates a new prompt.

#### func (c *Client) UpdatePrompt

```go
func (c *Client) UpdatePrompt(ctx context.Context, id string, req *PromptUpdateRequest) (*Prompt, error)
```
- `id` *(string, required)*
- `req` *(PromptUpdateRequest, required)*: Only non-nil fields are updated.

Updates a prompt by ID.

#### func (c *Client) DeletePrompt

```go
func (c *Client) DeletePrompt(ctx context.Context, id string) error
```
- `id` *(string, required)*

Deletes a prompt by ID.

#### func (c *Client) SearchPrompts

```go
func (c *Client) SearchPrompts(ctx context.Context, query string) ([]Prompt, error)
```
- `query` *(string, required)*: Full-text search against prompt title, content, and tags.

Returns prompts matching the query.

---

### Log Methods

#### func (c *Client) ListLogs

```go
func (c *Client) ListLogs(ctx context.Context) ([]Log, error)
```
- Lists all logs for the authenticated user.

#### func (c *Client) ListLogsByPrompt

```go
func (c *Client) ListLogsByPrompt(ctx context.Context, promptID string) ([]Log, error)
```
- `promptID` *(string, required)*: ID of the prompt whose logs you want.

Retrieves logs for a specific prompt.

#### func (c *Client) CreateLog

```go
func (c *Client) CreateLog(ctx context.Context, req *LogCreateRequest) (*Log, error)
```
- `req` *(LogCreateRequest, required)*

Creates a new log (output for a tested prompt).

#### func (c *Client) DeleteLog

```go
func (c *Client) DeleteLog(ctx context.Context, id string) error
```
- `id` *(string, required)*

Deletes a log by ID.

---

### Error Handling

- All methods return an `error` as the last return value.
- For API errors, the error is of type `*promptcrafter.Error`:
    ```go
    type Error struct {
        StatusCode int
        Message    string
    }
    func (e *Error) Error() string
    ```
- Error messages map to HTTP response status and detailed JSON error messages where available.
- Typical errors:
  - 400: Malformed request or required fields missing
  - 401: Invalid/missing token
  - 403: No access to resource
  - 404: Resource not found
  - 415: Content-Type not application/json
  - 409: Email already in use (signup)
  - 500: Server error

**Best practice:** Use Go error wrapping or type asserts to check for `*promptcrafter.Error` and handle based on `StatusCode`.

---

## Data Models

### Prompt

| Field      | Type       | Required | Description                                               |
|------------|------------|----------|-----------------------------------------------------------|
| ID         | string     | Yes      | Unique prompt identifier (`_id` in JSON)                  |
| OwnerID    | string     | Yes      | User who owns the prompt                                  |
| Title      | string     | Yes      | Prompt title                                              |
| Content    | string     | Yes      | Prompt text                                               |
| Model      | string     | Yes      | Intended model (ex: "GPT-4o")                             |
| Tags       | []string   | No       | Array of optional tags                                    |
| CreatedAt  | time.Time  | Yes      | Creation timestamp (server-set, ISO 8601)                 |
| UpdatedAt  | time.Time  | Yes      | Last update timestamp (server-set, ISO 8601)              |

### PromptCreateRequest

| Field   | Type     | Required | Description          |
|---------|----------|----------|----------------------|
| Title   | string   | Yes      | See above            |
| Content | string   | Yes      | See above            |
| Model   | string   | Yes      | See above            |
| Tags    | []string | No       | See above            |

### PromptUpdateRequest

| Field   | Type         | Required | Description                |
|---------|--------------|----------|----------------------------|
| Title   | *string      | No       | Only set field to update   |
| Content | *string      | No       | Only set field to update   |
| Model   | *string      | No       | Only set field to update   |
| Tags    | *[]string    | No       | Only set field to update   |

### Log

| Field     | Type      | Required | Description                                     |
|-----------|-----------|----------|-------------------------------------------------|
| ID        | string    | Yes      | Log identifier (`_id` in JSON)                  |
| PromptID  | string    | Yes      | Prompt which generated this log                 |
| Output    | string    | Yes      | Model output text                               |
| Notes     | string    | No       | Optional notes                                  |
| ModelUsed | string    | Yes      | Model used for output                           |
| Score     | *int      | No       | Optional output quality score (1-10)            |
| CreatedAt | time.Time | Yes      | When log was created (ISO 8601)                 |

### LogCreateRequest

| Field     | Type      | Required | Description                  |
|-----------|-----------|----------|------------------------------|
| PromptID  | string    | Yes      | See above                    |
| Output    | string    | Yes      | See above                    |
| Notes     | string    | No       | See above                    |
| ModelUsed | string    | Yes      | See above                    |
| Score     | *int      | No       | See above                    |

### AuthSignupRequest

| Field   | Type   | Required | Description                    |
|---------|--------|----------|--------------------------------|
| Name    | string | Yes      | User's name                    |
| Email   | string | Yes      | User's email                   |
| Password| string | Yes      | User's password                |

### AuthLoginRequest

| Field    | Type   | Required | Description         |
|----------|--------|----------|---------------------|
| Email    | string | Yes      | User's email        |
| Password | string | Yes      | User's password     |

### AuthResponse

| Field | Type   | Description          |
|-------|--------|----------------------|
| Token | string | JWT authentication   |

---

## Advanced Usage

### Context and Cancellation

All API calls require a `context.Context` parameter, supporting cancellation and timeouts:
```go
ctx, cancel := context.WithTimeout(context.Background(), 10*time.Second)
defer cancel()
resp, err := client.ListPrompts(ctx)
```

### Custom HTTP Client

To use a custom `http.Client` (set timeouts, proxies, etc.):
```go
customHTTP := &http.Client{Timeout: 5 * time.Second}
client := promptcrafter.NewClient("token", promptcrafter.WithHTTPClient(customHTTP))
```

### Custom API Base URL

For testing/staging:
```go
client := promptcrafter.NewClient("token", promptcrafter.WithBaseURL("https://staging.example.com"))
```

### Pagination

**Note:** The current API and SDK does _not_ implement pagination on list/search endpoints. All matching records are returned in one call.

---

## FAQ

**Q: What should I do if I receive a 401 Unauthorized error?**  
A: Ensure your bearer token is set, valid, and included in the client. Reauthenticate if expired.

**Q: How do I update only some fields of a prompt?**  
A: Use `UpdatePrompt` and set only non-nil fields in the `PromptUpdateRequest`.

**Q: What's the best way to diagnose API errors?**  
A: Check if the error is of type `*promptcrafter.Error`, and use the `StatusCode` and `Message` fields for debugging.

**Q: Are timestamps in UTC?**  
A: Yes, all server-generated timestamps are ISO 8601 UTC.

**Q: I need to report a bug or suggest a feature—where do I go?**  
A: See the **Contact/Support** section.

---

## Contact/Support

- **API Documentation:** [API Reference](https://promptcrafter-production.up.railway.app/docs/reference/index.md)
- **Help & Issues:** Use your project’s GitHub Issues or contact your support channel.
- **Bug reports/Feature requests:** Please provide reproducible steps, code samples, and relevant error messages.
